<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>MIDI Test</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #111;
      color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .card {
      background: #1e1e1e;
      border-radius: 16px;
      padding: 32px 40px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,.5);
      width: 320px;
    }

    .status {
      margin-top: 16px;
      font-size: 14px;
      opacity: .8;
    }

    .note {
      margin-top: 24px;
      font-size: 48px;
      font-weight: bold;
      color: #7cff7c;
      min-height: 56px;
    }

    .active {
      background: #0a3;
      color: #000;
      transition: background .1s;
    }
  </style>
</head>
<body>

  <div class="card" id="card">
    <h2>üéπ MIDI INPUT TEST</h2>
    <div class="status" id="status">ƒêang ch·ªù MIDI...</div>
    <div class="note" id="note">‚Äî</div>
    <div class="status">·∫§n ph√≠m ƒë√†n ƒë·ªÉ test</div>
  </div>

  <script>
    const statusEl = document.getElementById("status");
    const noteEl = document.getElementById("note");
    const card = document.getElementById("card");

    function midiNoteName(note) {
      const names = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
      return names[note % 12] + Math.floor(note / 12 - 1);
    }

    if (!navigator.requestMIDIAccess) {
      statusEl.textContent = "‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Web MIDI";
    } else {
      navigator.requestMIDIAccess().then(midi => {
        statusEl.textContent = "‚úÖ MIDI s·∫µn s√†ng ‚Äì ch·ªù ƒë√†n";

        for (let input of midi.inputs.values()) {
          console.log("MIDI device:", input.name);

          input.onmidimessage = e => {
            const [cmd, note, velocity] = e.data;

            // Note ON
            if (cmd === 144 && velocity > 0) {
              const name = midiNoteName(note);
              noteEl.textContent = name;
              card.classList.add("active");
            }

            // Note OFF
            if (cmd === 128 || (cmd === 144 && velocity === 0)) {
              card.classList.remove("active");
            }
          };
        }
      }).catch(err => {
        statusEl.textContent = "‚ùå Kh√¥ng truy c·∫≠p ƒë∆∞·ª£c MIDI";
        console.error(err);
      });
    }
  </script>

</body>
</html>
