<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Bolero Karaoke Guitar Player</title>
    <style>
        :root { --gold: #f1c40f; --bg: #1a1a1a; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .player { background: #333; padding: 30px; border-radius: 20px; width: 90%; max-width: 800px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 2px solid #444; }
        .lyrics-box { height: 180px; overflow: hidden; position: relative; border-bottom: 2px solid #444; margin-bottom: 20px; text-align: center; }
        .lyrics-container { position: absolute; width: 100%; transition: top 0.5s ease; top: 60px; }
        .line { font-size: 1.5rem; margin: 15px 0; opacity: 0.3; transition: 0.3s; }
        .line.active { opacity: 1; color: var(--gold); transform: scale(1.1); font-weight: bold; }
        .chord-indicator { font-size: 0.9rem; color: #e67e22; vertical-align: super; margin: 0 5px; }
        .visualizer { display: flex; justify-content: center; gap: 5px; height: 50px; align-items: flex-end; }
        .bar { width: 8px; background: var(--gold); height: 10%; transition: 0.1s; border-radius: 2px; }
        button { background: #27ae60; color: white; border: none; padding: 15px 40px; font-size: 1.2rem; border-radius: 50px; cursor: pointer; display: block; margin: 20px auto; transition: 0.3s; }
        button:hover { background: #2ecc71; transform: scale(1.05); }
    </style>
</head>
<body>

<div class="player">
    <div class="lyrics-box">
        <div id="lyricLines" class="lyrics-container">
            <div class="line" id="l0">Gõ cửa trái <span class="chord-indicator">[Dm]</span> tim...</div>
            <div class="line" id="l1">Gõ cửa trái <span class="chord-indicator">[Dm]</span> tim <span class="chord-indicator">[Gm]</span> van em được <span class="chord-indicator">[Dm]</span> vào</div>
            <div class="line" id="l2"><span class="chord-indicator">[F7]</span> Dù tình xót <span class="chord-indicator">[Bb]</span> xa <span class="chord-indicator">[C7]</span> chung thân huyệt <span class="chord-indicator">[F]</span> đào</div>
            <div class="line" id="l3">Ngủ <span class="chord-indicator">[A7]</span> vùi với chiêm <span class="chord-indicator">[Dm]</span> bao, nỗi <span class="chord-indicator">[D7]</span> niềm mắt xanh <span class="chord-indicator">[Gm]</span> xao</div>
            <div class="line" id="l4">Nhưng anh vẫn <span class="chord-indicator">[F]</span> ngóng tim em mở <span class="chord-indicator">[A7]</span> cửa</div>
            <div class="line" id="l5">Kết thúc đoạn 1</div>
        </div>
    </div>

    <div class="visualizer" id="viz">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>

    <button id="startBtn">▶ BẮT ĐẦU CHƠI NHẠC</button>
</div>

<script>
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    let audioCtx;
    let isPlaying = false;

    // Tần số nốt nhạc
    const notes = { D2: 73.42, D3: 146.83, F3: 174.61, A3: 220.00, Bb3: 233.08, C4: 261.63, D4: 293.66, G2: 98.00, G3: 196.00, E2: 82.41, A2: 110.00 };

    function createGuitarTone(freq, time, duration, vol) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(freq, time);
        gain.gain.setValueAtTime(0, time);
        gain.gain.linearRampToValueAtTime(vol, time + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.001, time + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(time);
        osc.stop(time + duration);
    }

    function playPercussion(time) {
        // Mô phỏng tiếng gõ Conga (low)
        createGuitarTone(100, time, 0.1, 0.1);
        // Mô phỏng tiếng "Chát" (high)
        createGuitarTone(600, time + 0.5, 0.05, 0.05);
    }

    function playBoleroBar(chord, startTime) {
        const tempo = 0.8; // Giây mỗi nhịp
        // Bass
        let bass = notes.D2;
        let triad = [notes.D3, notes.F3, notes.A3];
        
        if(chord === 'Gm') { bass = notes.G2; triad = [notes.G3, notes.Bb3, notes.D4]; }
        if(chord === 'A7') { bass = notes.A2; triad = [notes.A3, notes.C4, notes.D4]; }
        if(chord === 'Bb') { bass = notes.Bb3/2; triad = [notes.Bb3, notes.D4, notes.F3]; }

        createGuitarTone(bass, startTime, 1.2, 0.6); // Bùm
        createGuitarTone(triad[0], startTime + tempo*0.25, 0.4, 0.3); // rải 3
        createGuitarTone(triad[1], startTime + tempo*0.35, 0.4, 0.3); // rải 2
        createGuitarTone(triad[2], startTime + tempo*0.45, 0.4, 0.3); // rải 1
        
        // Tiếng Chát
        createGuitarTone(triad[0], startTime + tempo*0.7, 0.1, 0.2);
        createGuitarTone(triad[1], startTime + tempo*0.7, 0.1, 0.2);
        createGuitarTone(triad[2], startTime + tempo*0.7, 0.1, 0.2);

        playPercussion(startTime);
    }

    const sequence = [
        { t: 0, chord: 'Dm', line: 0 },
        { t: 3.2, chord: 'Dm', line: 1 },
        { t: 6.4, chord: 'Gm', line: 1 },
        { t: 9.6, chord: 'Dm', line: 1 },
        { t: 12.8, chord: 'F7', line: 2 },
        { t: 16.0, chord: 'Bb', line: 2 },
        { t: 19.2, chord: 'C7', line: 2 },
        { t: 22.4, chord: 'A7', line: 3 },
        { t: 25.6, chord: 'Dm', line: 3 },
        { t: 28.8, chord: 'A7', line: 4 }
    ];

    document.getElementById('startBtn').onclick = function() {
        if (!audioCtx) audioCtx = new AudioCtx();
        if (isPlaying) return;
        isPlaying = true;
        this.style.display = 'none';

        const startTime = audioCtx.currentTime + 0.5;

        sequence.forEach(step => {
            const playTime = startTime + step.t;
            
            // Lên lịch chơi nhạc
            playBoleroBar(step.chord, playTime);

            // Lên lịch chạy lời
            setTimeout(() => {
                document.querySelectorAll('.line').forEach(l => l.classList.remove('active'));
                document.getElementById('l' + step.line).classList.add('active');
                document.getElementById('lyricLines').style.top = (60 - (step.line * 50)) + 'px';
                
                // Visualizer nhẩy
                document.querySelectorAll('.bar').forEach(b => b.style.height = Math.random()*100 + '%');
            }, step.t * 1000);
        });
    };
</script>

</body>
</html>
