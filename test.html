<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Th·ª±c h√†nh Tay Ph·∫£i: G√µ C·ª≠a Tr√°i Tim</title>
    <style>
        :root { --gold: #f1c40f; --bg: #121212; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .player { background: #222; padding: 30px; border-radius: 20px; width: 95%; max-width: 900px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); border: 1px solid #333; }
        
        .lyrics-area { height: 150px; text-align: center; margin-bottom: 20px; overflow: hidden; }
        .line { font-size: 1.6rem; transition: 0.3s; opacity: 0.2; margin: 10px 0; }
        .line.active { opacity: 1; color: var(--gold); transform: scale(1.1); }

        .control-panel { display: flex; justify-content: space-around; background: #333; padding: 20px; border-radius: 15px; margin-top: 20px; }
        .option-card { text-align: center; flex: 1; padding: 10px; border: 2px solid transparent; cursor: pointer; border-radius: 10px; transition: 0.3s; }
        .option-card:hover { background: #444; }
        .option-card.selected { border-color: var(--gold); background: #444; }
        
        .guitar-strings { height: 100px; display: flex; flex-direction: column; justify-content: space-between; margin: 20px 0; position: relative; }
        .string { height: 2px; background: #666; width: 100%; position: relative; }
        .active-string { background: var(--gold) !important; box-shadow: 0 0 10px var(--gold); }

        .main-btn { background: #e67e22; color: white; border: none; padding: 15px 50px; font-size: 1.2rem; border-radius: 50px; cursor: pointer; margin: 20px auto; display: block; }
        .status-badge { text-align: center; color: var(--gold); font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div class="player">
    <h2 style="text-align:center">üé∏ ·ª®ng d·ª•ng Tay Ph·∫£i: G√µ C·ª≠a Tr√°i Tim</h2>
    
    <div class="lyrics-area">
        <div id="l1" class="line">G√µ c·ª≠a tr√°i [Dm] tim van em ƒë∆∞·ª£c [Dm] v√†o...</div>
        <div id="l2" class="line">√îi c·ª≠a tim em [Bb] b·∫±ng v√†ng...</div>
    </div>

    <div class="guitar-strings" id="neck">
        <div class="string" id="s6"></div><div class="string" id="s5"></div>
        <div class="string" id="s4"></div><div class="string" id="s3"></div>
        <div class="string" id="s2"></div><div class="string" id="s1"></div>
    </div>

    <div class="control-panel">
        <div class="option-card selected" id="optRai" onclick="setMode('rai')">
            <h3>OPTION 1: R·∫¢I</h3>
            <p>(Bass - 3 - 2 - 1)</p>
            <small>D√πng cho L·ªùi 1 & 2</small>
        </div>
        <div class="option-card" id="optQuat" onclick="setMode('quat')">
            <h3>OPTION 2: QU·∫†T</h3>
            <p>(Xu·ªëng - Ch√°t - L√™n - L√™n)</p>
            <small>D√πng cho ƒêI·ªÜP KH√öC</small>
        </div>
    </div>

    <button class="main-btn" id="startBtn">B·∫ÆT ƒê·∫¶U ƒê·ªÜM NH·∫†C</button>
    <div id="status" class="status-badge">Ch·∫ø ƒë·ªô hi·ªán t·∫°i: R·∫¢I (T√¨nh c·∫£m)</div>
</div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let mode = 'rai';
    let isPlaying = false;

    function setMode(m) {
        mode = m;
        document.getElementById('optRai').classList.toggle('selected', m === 'rai');
        document.getElementById('optQuat').classList.toggle('selected', m === 'quat');
        document.getElementById('status').innerText = "Ch·∫ø ƒë·ªô hi·ªán t·∫°i: " + (m === 'rai' ? "R·∫¢I (T√¨nh c·∫£m)" : "QU·∫†T (M·∫°nh m·∫Ω)");
    }

    function playNote(freq, time, dur) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(freq, time);
        gain.gain.setValueAtTime(0.3, time);
        gain.gain.exponentialRampToValueAtTime(0.01, time + dur);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(time); osc.stop(time + dur);
    }

    function animateString(s) {
        const el = document.getElementById('s' + s);
        el.classList.add('active-string');
        setTimeout(() => el.classList.remove('active-string'), 200);
    }

    function playLoop(chord, startTime) {
        const t = startTime;
        const bassFreq = chord === 'Dm' ? 146 : 110; // D√¢y 4 ho·∫∑c d√¢y 5
        const bassString = chord === 'Dm' ? 4 : 5;

        if (mode === 'rai') {
            // Bass - 3 - 2 - 1
            playNote(bassFreq, t, 1); animateString(bassString);
            playNote(196, t + 0.3, 0.5); setTimeout(() => animateString(3), 300);
            playNote(246, t + 0.6, 0.5); setTimeout(() => animateString(2), 600);
            playNote(293, t + 0.9, 0.5); setTimeout(() => animateString(1), 900);
        } else {
            // Qu·∫°t: Bass - Xu·ªëng - Ch√°t - L√™n
            playNote(bassFreq, t, 1); animateString(bassString);
            // Gi·∫£ l·∫≠p ti·∫øng qu·∫°t b·∫±ng c√°ch ph√°t nhanh nhi·ªÅu n·ªët
            [200, 250, 300].forEach((f, i) => {
                playNote(f, t + 0.4 + (i*0.02), 0.2);
                setTimeout(() => animateString(3-i), 400);
            });
        }
    }

    document.getElementById('startBtn').onclick = function() {
        if (isPlaying) return;
        isPlaying = true;
        this.disabled = true;
        this.innerText = "ƒêANG CH∆†I...";

        let now = audioCtx.currentTime;
        
        // V√≤ng l·∫∑p m√¥ ph·ªèng
        for(let i=0; i<20; i++) {
            let chord = i < 8 ? 'Dm' : 'Bb';
            let line = i < 8 ? 'l1' : 'l2';
            
            setTimeout(() => {
                document.querySelectorAll('.line').forEach(l => l.classList.remove('active'));
                document.getElementById(line).classList.add('active');
            }, i * 1500);

            playLoop(chord, now + (i * 1.5));
        }
    };
</script>
</body>
</html>
