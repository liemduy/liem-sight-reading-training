<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thực hành Guitar Bolero</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f4f9; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 800px; }
        h2 { text-align: center; color: #2c3e50; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .section { border: 1px solid #ddd; padding: 15px; border-radius: 10px; background: #fafafa; }
        h3 { margin-top: 0; font-size: 1.1em; color: #e67e22; border-bottom: 2px solid #e67e22; padding-bottom: 5px; }
        label { display: block; margin: 10px 0; cursor: pointer; padding: 8px; border-radius: 5px; transition: background 0.3s; }
        label:hover { background: #eee; }
        input[type="radio"] { margin-right: 10px; }
        .controls { margin-top: 30px; text-align: center; border-top: 2px solid #eee; pt: 20px; }
        button { background: #27ae60; color: white; border: none; padding: 12px 30px; font-size: 1.1em; border-radius: 25px; cursor: pointer; transition: 0.3s; }
        button:hover { background: #219150; transform: scale(1.05); }
        button:disabled { background: #bdc3c7; cursor: not-allowed; }
        .visualizer { margin-top: 20px; height: 60px; display: flex; align-items: flex-end; justify-content: center; gap: 5px; }
        .bar { width: 10px; background: #3498db; transition: height 0.1s; border-radius: 5px 5px 0 0; }
        .status { margin-top: 10px; font-weight: bold; color: #7f8c8d; }
    </style>
</head>
<body>

<div class="container">
    <h2>Học Đệm Guitar Bolero</h2>
    
    <div class="grid">
        <div class="section">
            <h3>1. Chọn Cách Đệm</h3>
            <label>
                <input type="radio" name="rhythm" value="basic" checked> 
                <strong>Cách 1: Cơ bản</strong><br>
                <small>(Bát - 3 - 2 - 1 - 3 - 2 - 3 - 1 - 2 - 3)</small>
            </label>
            <label>
                <input type="radio" name="rhythm" value="legend"> 
                <strong>Cách 2: Huyền thoại</strong><br>
                <small>(Bát-321 - Chát - Bát - Chát...)</small>
            </label>
        </div>

        <div class="section">
            <h3>2. Chọn Hợp Âm</h3>
            <label><input type="radio" name="chord" value="Am" checked> <b>La Thứ (Am)</b> - Trầm buồn</label>
            <label><input type="radio" name="chord" value="Dm"> <b>Rê Thứ (Dm)</b> - Da diết</label>
            <label><input type="radio" name="chord" value="E"> <b>Mi Trưởng (E)</b> - Căng thẳng</label>
        </div>
    </div>

    <div class="controls">
        <button id="playBtn">PHÁT THỬ (PLAY)</button>
        <div class="status" id="statusText">Sẵn sàng thực hành!</div>
        <div class="visualizer" id="viz">
            <div class="bar" style="height: 10%"></div>
            <div class="bar" style="height: 10%"></div>
            <div class="bar" style="height: 10%"></div>
            <div class="bar" style="height: 10%"></div>
            <div class="bar" style="height: 10%"></div>
        </div>
    </div>
</div>

<script>
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    let isPlaying = false;

    // Tần số các hợp âm (tượng trưng)
    const frequencies = {
        'Am': [110, 220, 261, 329], // A2, A3, C4, E4
        'Dm': [146, 293, 349, 440], // D3, D4, F4, A4
        'E': [82, 164, 207, 246]    // E2, E3, G#3, B3
    };

    function playNote(freq, type, duration, volume = 0.5) {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, ctx.currentTime);
        gain.gain.setValueAtTime(volume, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + duration);
        
        // Hiệu ứng visualizer
        const bars = document.querySelectorAll('.bar');
        bars.forEach(bar => bar.style.height = Math.random() * 100 + '%');
        setTimeout(() => bars.forEach(bar => bar.style.height = '10%'), duration * 1000);
    }

    async function playSequence() {
        if (isPlaying) return;
        isPlaying = true;
        document.getElementById('playBtn').disabled = true;
        
        const rhythm = document.querySelector('input[name="rhythm"]:checked').value;
        const chordKey = document.querySelector('input[name="chord"]:checked').value;
        const f = frequencies[chordKey];
        const status = document.getElementById('statusText');

        if (rhythm === 'basic') {
            status.innerText = "Đang chơi: Cách 1 (Rải dây)...";
            const pattern = [f[0], f[1], f[2], f[3], f[1], f[2], f[1], f[3], f[2], f[1]];
            for (let note of pattern) {
                playNote(note, 'sine', 0.4);
                await new Promise(r => setTimeout(r, 400));
            }
        } else {
            status.innerText = "Đang chơi: Cách 2 (Quạt/Chát)...";
            // Bass
            playNote(f[0], 'triangle', 0.5, 0.8);
            await new Promise(r => setTimeout(r, 400));
            // 321
            playNote(f[1], 'sine', 0.2); playNote(f[2], 'sine', 0.2); playNote(f[3], 'sine', 0.2);
            await new Promise(r => setTimeout(r, 400));
            // Chát
            status.innerText = "Chát!";
            playNote(f[1], 'square', 0.1, 0.3); playNote(f[2], 'square', 0.1, 0.3);
            await new Promise(r => setTimeout(r, 400));
            // Bass phụ
            playNote(f[1], 'triangle', 0.5, 0.6);
            await new Promise(r => setTimeout(r, 400));
        }

        isPlaying = false;
        document.getElementById('playBtn').disabled = false;
        status.innerText = "Hoàn thành! Chọn tổ hợp khác và thử lại.";
    }

    document.getElementById('playBtn').addEventListener('click', () => {
        if (ctx.state === 'suspended') ctx.resume();
        playSequence();
    });
</script>

</body>
</html>
